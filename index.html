<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Gaming Tournaments | User Dashboard</title>
    <style>
        :root {
            --primary: #00ff88;
            --secondary: #7000ff;
            --bg: #0a0a12;
            --card: #151520;
            --text: #ffffff;
            --danger: #ff2a2a;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 70px; }
        
        /* Layout */
        header {
            background: rgba(21, 21, 32, 0.95);
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-weight: 800; font-size: 1.2rem; color: var(--primary); text-transform: uppercase; }
        .ticket-balance {
            background: linear-gradient(45deg, var(--secondary), #aa00ff);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Nav */
        nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: var(--card);
            display: flex;
            justify-content: space-around;
            padding: 15px;
            border-top: 1px solid #333;
            z-index: 100;
        }
        nav button {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
        }
        nav button.active { color: var(--primary); }

        /* Sections */
        .section { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Profile */
        .profile-card {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #333;
        }
        .input-group { margin: 15px 0; text-align: left; }
        .input-group label { display: block; color: #888; font-size: 0.8rem; margin-bottom: 5px; }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            background: #000;
            border: 1px solid #444;
            color: white;
            border-radius: 5px;
        }

        /* Tournaments */
        .tournament-card {
            background: var(--card);
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            border: 1px solid #333;
            position: relative;
        }
        .t-header {
            background: #222;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        .game-tag { background: var(--secondary); padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }
        .t-body { padding: 15px; }
        .t-info { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; color: #ccc; }
        .progress-bar {
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill { height: 100%; background: var(--primary); transition: width 0.3s; }
        
        .join-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }
        .btn-active { background: var(--primary); color: #000; }
        .btn-disabled { background: #333; color: #666; cursor: not-allowed; }

        /* Games Grid */
        .games-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .game-thumb {
            background: var(--card);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--secondary);
            cursor: pointer;
        }

        /* Ads */
        .ad-banner {
            width: 100%;
            height: 60px;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            color: #444;
            font-size: 0.8rem;
            border: 1px dashed #444;
        }
        .ad-native {
            min-height: 150px;
            background: #1a1a1a;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            padding: 20px;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: var(--card);
            padding: 20px;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--primary);
        }
        
        /* Tic Tac Toe */
        .ttt-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin: 20px 0; }
        .ttt-cell {
            aspect-ratio: 1;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
        }

        /* Legal */
        .legal-links { text-align: center; margin-top: 30px; font-size: 0.8rem; color: #666; }
        .legal-links a { color: #888; text-decoration: none; margin: 0 5px; }
        
        #banned-screen {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            color: var(--danger);
            text-align: center;
            padding-top: 200px;
            font-size: 1.5rem;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="banned-screen">ACCOUNT BANNED<br><span style="font-size:1rem; color:#fff">Contact Administrator</span></div>

    <header>
        <div class="logo">Gamers<span style="color:var(--secondary)">Hub</span></div>
        <div class="ticket-balance">
            <span>üé´</span> <span id="ticketDisplay">0</span>
        </div>
    </header>

    <!-- AD PLACEMENT HEADER -->
    <div class="ad-banner">MONETAG BANNER AD 320x50</div>

    <!-- HOME SECTION -->
    <div id="home" class="section active">
        <h2>Live Tournaments</h2>
        <div class="ad-native">MONETAG NATIVE AD</div>
        <div id="tournament-list">
            <!-- Tournaments load here -->
        </div>
    </div>

    <!-- GAMES SECTION -->
    <div id="games" class="section">
        <h2>Earn Tickets</h2>
        <p style="color:#888; font-size: 0.9rem; margin-bottom: 15px;">Complete games to earn tickets. No tickets for ads.</p>
        <div class="games-grid">
            <div class="game-thumb" onclick="openGame('ttt')">
                <h3>Tic Tac Toe</h3>
                <p>Win to get +2 Tickets</p>
            </div>
            <div class="game-thumb" onclick="alert('Math Puzzle coming soon!')">
                <h3>Math Quiz</h3>
                <p>Coming Soon</p>
            </div>
        </div>
        <div class="ad-native">MONETAG NATIVE AD</div>
    </div>

    <!-- PROFILE SECTION -->
    <div id="profile" class="section">
        <h2>My Profile</h2>
        <div class="profile-card">
            <div class="input-group">
                <label>Username (Auto)</label>
                <input type="text" id="p-username" readonly>
            </div>
            <div class="input-group">
                <label>BGMI ID</label>
                <input type="text" id="p-bgmi" placeholder="Enter BGMI ID" onchange="updateProfile()">
            </div>
            <div class="input-group">
                <label>Free Fire ID</label>
                <input type="text" id="p-ff" placeholder="Enter FF ID" onchange="updateProfile()">
            </div>
            <div class="input-group">
                <label>Email (Read Only)</label>
                <input type="text" value="user@guest.com" readonly style="opacity:0.5">
            </div>
        </div>
        
        <h3 style="margin-top:20px">History</h3>
        <div id="history-list" style="margin-top:10px; font-size: 0.9rem; color: #aaa;"></div>

        <div class="legal-links">
            <a href="#" onclick="alert('Disclaimer: This platform is for tournament management only. No real money gambling. Tickets have no monetary value.')">Disclaimer</a> |
            <a href="#" onclick="alert('Privacy Policy: We store data locally on your device.')">Privacy</a> |
            <a href="#" onclick="alert('Terms: By using this site you agree to fair play rules.')">Terms</a>
            <br><br>
            <a href="https://www.instagram.com/malik_boy_5798?igsh=cjM1MmN1cXVvcml6" target="_blank" style="color:var(--primary)">Contact Us (Instagram)</a>
        </div>
    </div>

    <!-- AD PLACEMENT FOOTER -->
    <div class="ad-banner">MONETAG BANNER AD 320x50</div>

    <nav>
        <button onclick="nav('home')" class="active" id="btn-home">üè†</button>
        <button onclick="nav('games')" id="btn-games">üéÆ</button>
        <button onclick="nav('profile')" id="btn-profile">üë§</button>
    </nav>

    <!-- MODALS -->
    
    <!-- JOIN MODAL -->
    <div id="joinModal" class="modal">
        <div class="modal-content">
            <h3>Join Tournament</h3>
            <p id="jm-name" style="color:var(--secondary)"></p>
            <div class="input-group">
                <label>Game ID for this match</label>
                <input type="text" id="jm-gameid">
            </div>
            <div class="input-group">
                <label>Squad Mode</label>
                <select id="jm-mode" style="width:100%; padding:10px; background:#000; color:#fff; border:1px solid #444;">
                    <option>Solo</option>
                    <option>Duo</option>
                    <option>Squad</option>
                </select>
            </div>
            <div style="margin: 15px 0;">
                <input type="checkbox" id="jm-rules"> <label for="jm-rules">I agree to rules</label>
            </div>
            <button class="join-btn btn-active" onclick="confirmJoin()">CONFIRM JOIN</button>
            <button class="join-btn" style="background:#333; margin-top:10px" onclick="closeModals()">CANCEL</button>
        </div>
    </div>

    <!-- GAME MODAL (TIC TAC TOE) -->
    <div id="gameModal" class="modal">
        <div class="modal-content" style="text-align:center">
            <h3>Tic Tac Toe</h3>
            <p>Win against AI to get tickets!</p>
            <div id="ttt-board" class="ttt-board"></div>
            <p id="ttt-status"></p>
            <button class="join-btn" style="background:#333;" onclick="closeModals()">EXIT</button>
        </div>
    </div>

    <script>
        // --- DATA MANAGEMENT ---
        const LS_USER = 'gamerUser';
        const LS_TOURNAMENTS = 'tournaments';
        const LS_BANNED = 'bannedUsers';

        let currentUser = JSON.parse(localStorage.getItem(LS_USER)) || {
            username: 'User_' + Math.floor(Math.random() * 10000),
            bgmiId: '',
            ffId: '',
            tickets: 10,
            history: [],
            activeTime: 0
        };

        // --- INIT ---
        window.onload = function() {
            checkBan();
            updateUI();
            loadTournaments();
            startTicketTimer();
        };

        function saveUser() {
            localStorage.setItem(LS_USER, JSON.stringify(currentUser));
            updateUI();
        }

        function updateUI() {
            document.getElementById('ticketDisplay').innerText = currentUser.tickets;
            document.getElementById('p-username').value = currentUser.username;
            document.getElementById('p-bgmi').value = currentUser.bgmiId;
            document.getElementById('p-ff').value = currentUser.ffId;
            
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = currentUser.history.length ? '' : 'No tournaments joined yet.';
            currentUser.history.forEach(h => {
                historyList.innerHTML += `<div style="border-bottom:1px solid #333; padding:5px;">${h.name} - ${h.date}</div>`;
            });
        }

        function checkBan() {
            let bannedList = JSON.parse(localStorage.getItem(LS_BANNED)) || [];
            if (bannedList.includes(currentUser.username)) {
                document.getElementById('banned-screen').style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        function updateProfile() {
            currentUser.bgmiId = document.getElementById('p-bgmi').value;
            currentUser.ffId = document.getElementById('p-ff').value;
            saveUser();
        }

        // --- NAVIGATION ---
        function nav(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + sectionId).classList.add('active');
        }

        // --- TICKET SYSTEM ---
        function startTicketTimer() {
            setInterval(() => {
                if (document.visibilityState === 'visible') {
                    currentUser.activeTime++;
                    // Give 1 ticket every 5 minutes (300 seconds)
                    if (currentUser.activeTime % 300 === 0) {
                        currentUser.tickets++;
                        saveUser();
                        // Optional toast could go here
                    }
                }
            }, 1000);
        }

        // --- TOURNAMENT SYSTEM ---
        function loadTournaments() {
            const list = document.getElementById('tournament-list');
            const tournaments = JSON.parse(localStorage.getItem(LS_TOURNAMENTS)) || [];
            
            list.innerHTML = '';
            if (tournaments.length === 0) {
                list.innerHTML = '<p style="text-align:center; padding:20px; color:#666">No active tournaments.</p>';
                return;
            }

            tournaments.forEach((t, index) => {
                const filledPct = (t.joined / t.slots) * 100;
                let btnState = 'btn-active';
                let btnText = 'JOIN NOW';
                let btnAction = `openJoin(${index})`;

                if (t.status === 'Closed') { btnState = 'btn-disabled'; btnText = 'CLOSED'; btnAction = ''; }
                else if (t.joined >= t.slots) { btnState = 'btn-disabled'; btnText = 'FULL'; btnAction = ''; }
                else if (currentUser.tickets < t.cost) { btnState = 'btn-disabled'; btnText = `NEED ${t.cost} TICKETS`; btnAction = ''; }

                // Check if already joined
                const hasJoined = currentUser.history.some(h => h.id === t.id);
                if (hasJoined) {
                    btnState = 'btn-disabled'; 
                    btnText = 'JOINED'; 
                    
                    // Show Room details if joined
                    let roomInfo = '';
                    if(t.roomId) {
                        roomInfo = `<div style="background:#222; color:#0f0; padding:10px; margin-top:5px; border:1px dashed #0f0;">
                            ROOM ID: ${t.roomId}<br>PASS: ${t.roomPass}
                        </div>`;
                    } else {
                        roomInfo = `<div style="background:#222; color:#f0a; padding:5px; margin-top:5px; font-size:0.8rem">Room details coming soon</div>`;
                    }
                    
                    btnAction = ''; 
                    // Replace button with room info
                }

                const html = `
                <div class="tournament-card">
                    <div class="t-header">
                        <span style="font-weight:bold">${t.name}</span>
                        <span class="game-tag">${t.game}</span>
                    </div>
                    <div class="t-body">
                        <div class="t-info"><span>üìÖ ${t.date}</span> <span>‚è∞ ${t.time}</span></div>
                        <div class="t-info"><span>üéüÔ∏è Cost: ${t.cost} Tickets</span> <span>üë• ${t.joined}/${t.slots}</span></div>
                        <div class="progress-bar"><div class="progress-fill" style="width:${filledPct}%"></div></div>
                        ${hasJoined ? (t.roomId ? `<div style="background:#111; border:1px solid var(--primary); color:var(--primary); padding:10px; text-align:center; font-weight:bold; margin-bottom:10px;">ID: ${t.roomId} | PASS: ${t.roomPass}</div>` : `<div style="text-align:center; color:#888; margin-bottom:10px;">Joined! Wait for Room ID</div>`) : 
                        `<button class="join-btn ${btnState}" onclick="${btnAction}">${btnText}</button>`}
                    </div>
                </div>`;
                list.innerHTML += html;
            });
        }

        let selectedTournamentIndex = null;

        function openJoin(index) {
            const tournaments = JSON.parse(localStorage.getItem(LS_TOURNAMENTS));
            const t = tournaments[index];
            if (!currentUser.bgmiId && !currentUser.ffId) {
                alert("Please save your Game ID in Profile first!");
                nav('profile');
                return;
            }
            selectedTournamentIndex = index;
            document.getElementById('jm-name').innerText = t.name;
            document.getElementById('jm-gameid').value = t.game === 'BGMI' ? currentUser.bgmiId : currentUser.ffId;
            document.getElementById('joinModal').style.display = 'flex';
        }

        function confirmJoin() {
            if (!document.getElementById('jm-rules').checked) { alert("Accept rules first."); return; }
            
            const tournaments = JSON.parse(localStorage.getItem(LS_TOURNAMENTS));
            const t = tournaments[selectedTournamentIndex];
            
            // Deduct tickets
            currentUser.tickets -= t.cost;
            
            // Add to history
            currentUser.history.push({
                id: t.id,
                name: t.name,
                date: new Date().toLocaleDateString()
            });
            saveUser();

            // Update Tournament Data (In localStorage for Admin to see participants)
            t.joined++;
            if (!t.participants) t.participants = [];
            t.participants.push({
                username: currentUser.username,
                gameId: document.getElementById('jm-gameid').value,
                mode: document.getElementById('jm-mode').value
            });
            localStorage.setItem(LS_TOURNAMENTS, JSON.stringify(tournaments));

            closeModals();
            loadTournaments();
            alert("Joined Successfully!");
        }

        function closeModals() {
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
        }

        // --- GAME LOGIC (Tic Tac Toe) ---
 
